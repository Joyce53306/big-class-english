<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <link rel="manifest" href="manifest.json">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§ç­å£èªªç·´ç¿’</title>
    <style>
        body { font-family: sans-serif; text-align: center; background-color: #FFF9E3; padding: 20px; }
        .card { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 500px; margin: auto; }
        select { font-size: 16px; padding: 8px; width: 100%; margin: 10px 0; border-radius: 10px; }
        .sentence-box { font-size: 22px; color: #333; font-weight: bold; margin: 30px 0; padding: 15px; background: #F0F0F0; border-radius: 10px; }
        .btn-group { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        .btn { border: none; width: 65px; height: 65px; border-radius: 50%; font-size: 24px; cursor: pointer; color: white; transition: 0.3s; }
        
        /* é»ƒè‰²ï¼šè½è€å¸«å”¸ */
        #play-example { background: #FFD700; color: #444; } 
        /* è—è‰²ï¼šéŒ„éŸ³ */
        #record-btn { background: #42A5F5; }
        /* ç´…è‰²ï¼šè½è‡ªå·±å”¸ (é è¨­éš±è—ï¼ŒéŒ„å®Œæ‰å‡ºç¾) */
        #play-mine { background: #FF5252; display: none; } 

        #status { margin-top: 20px; font-weight: bold; color: #2E86C1; min-height: 40px; }
    </style>
</head>
<body>
    <div class="card">
        <h1>ğŸ“ å¤§ç­å£èªªæŒ‘æˆ° (L1-L10)</h1>
        <select id="lesson-select" onchange="initLesson()"></select>
        <select id="sentence-select" onchange="showSentence()"></select>
        
        <div class="sentence-box" id="display-text">è¼‰å…¥ä¸­...</div>

        <div class="btn-group">
            <button id="play-example" class="btn" title="è½ç¯„ä¾‹">ğŸ”Š</button>
            <button id="record-btn" class="btn" title="é–‹å§‹éŒ„éŸ³">ğŸ¤</button>
            <button id="play-mine" class="btn" title="è½è‡ªå·±å”¸">ğŸ‘‚</button>
        </div>
        
        <p id="status">é»æ“Šé»ƒè‰²å–‡å­è½è€å¸«å”¸</p>
    </div>

    <script>
        const curriculum = {
            "L1: è·æ¥­": ["I want to be a chef.", "I want to be a doctor.", "I want to be a teacher."],
            "L2: é‹å‹•": ["I tried to kick the ball.", "I canâ€™t kick the ball.", "I tried to catch the ball."],
            "L10: æƒ³åƒèŠ±åœ’": ["If I had a garden, I would grow lollipops.", "A silly puppy would make me laugh."]
        };

        const lS = document.getElementById('lesson-select');
        const sS = document.getElementById('sentence-select');
        const disp = document.getElementById('display-text');
        const status = document.getElementById('status');
        let mediaRecorder;
        let audioChunks = [];
        let audioUrl;

        // åˆå§‹åŒ–é¸å–®
        for (let l in curriculum) { lS.options.add(new Option(l, l)); }
        function initLesson() {
            sS.innerHTML = "";
            curriculum[lS.value].forEach(s => sS.options.add(new Option(s, s)));
            showSentence();
        }
        function showSentence() { 
            disp.innerText = sS.value; 
            status.innerText = "è«‹è½ç¯„ä¾‹";
            document.getElementById('play-mine').style.display = 'none'; // åˆ‡æ›å¥å­æ™‚éš±è—é‡æ’­éµ
        }
        initLesson();

        // 1. è½ç¯„ä¾‹ (è€å¸«å”¸)
        document.getElementById('play-example').onclick = () => {
            const utter = new SpeechSynthesisUtterance(disp.innerText);
            utter.lang = 'en-US';
            utter.rate = 0.8;
            window.speechSynthesis.speak(utter);
            status.innerText = "è½å®Œå¾Œï¼Œæ›ä½ é»éº¥å…‹é¢¨å”¸å”¸çœ‹ï¼";
        };

        // 2. éŒ„éŸ³åŠŸèƒ½
        document.getElementById('record-btn').onclick = async function() {
            if (!mediaRecorder || mediaRecorder.state === 'inactive') {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    audioUrl = URL.createObjectURL(audioBlob);
                    document.getElementById('play-mine').style.display = 'inline-block';
                    status.innerText = "éŒ„éŸ³çµæŸï¼é»æ“Šç´…è‰²è€³æœµè½è½çœ‹è‡ªå·±çš„è²éŸ³ã€‚";
                };
                mediaRecorder.start();
                this.style.transform = "scale(1.2)";
                status.innerText = "æ­£åœ¨éŒ„éŸ³ä¸­...èªªå®Œå†é»ä¸€æ¬¡éº¥å…‹é¢¨";
            } else {
                mediaRecorder.stop();
                this.style.transform = "scale(1)";
            }
        };

        // 3. è½è‡ªå·±å”¸ (å›æ”¾)
        document.getElementById('play-mine').onclick = () => {
            if (audioUrl) {
                const audio = new Audio(audioUrl);
                audio.play();
                status.innerText = "æ­£åœ¨æ’­æ”¾ä½ çš„è²éŸ³...";
            }
        };
    </script>
</body>
</html>
